<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panchabyanjan Billing App</title>
  <style>
    body { font-family: 'Courier New', monospace; margin: 0; padding: 10px; width: 2.8in; background: #fff; color: #000; }
    .header, .bill-summary { text-align: center; }
    .header h2 { margin: 0; font-size: 1em; white-space: nowrap; }
    .header p { margin: 2px 0; font-size: 0.8em; }
    .field-group { font-size: 0.8em; margin-bottom: 4px; }
    table { width: 100%; border-collapse: collapse; font-size: 0.75em; }
    th, td { border-top: 1px dashed #000; padding: 2px 0; text-align: left; }
    .total-area { font-weight: bold; margin-top: 5px; border-top: 1px solid black; padding-top: 5px; text-align: right; white-space: pre-line; }
    .search-box, input, select, button { font-size: 0.8em; }
    .qr-code { text-align: center; margin-top: 10px; }
    .qr-code img { width: 100px; height: auto; margin: 0 auto; display: block; }
    .qr-label { font-size: 0.75em; margin-top: 5px; text-align: center; }
    .no-print { display: block; margin: 5px 0; }
    @media print {
      .no-print { display: none; }
      body { margin: 0; width: 2.8in; height: auto; }
    }
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  </style>
</head>
<body>
  <div class="header">
    <h2>Panchabyanjan Restaurant and Caterer</h2>
    <p>86 Tarafdarpara Rd, Kolkata, 700151</p>
    <p>Phone: 6290300741</p>
    <p>Email: panchabyanrestaurant@gmail.com</p>
    <p><strong>Bill No: <span id="billNumber"></span></strong></p>
  </div>

  <div class="field-group">
    <label>Bill To: <span id="customerDisplay"></span></label>
  </div>

  <table id="billTable">
    <thead>
      <tr><th>Item</th><th>Qty</th><th>Rate</th><th>Total</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="total-area" id="totalDisplay"></div>

  <div class="bill-summary">
    <p style="margin-top: 10px; font-size: 0.75em; text-align: center;">Thank you for your order!<br>WE ACCEPT PARTY BOOKING</p>
  </div>
  <div class="qr-code">
    <div class="qr-label">Scan to Pay</div>
    <img src="WhatsApp%20Image%202025-06-23%20at%2012.23.26%20PM.jpeg" alt="UPI QR Code" />
  </div>

  <div class="no-print">
<hr>
<h4>Monthly Billing Report</h4>
From: <input type="date" id="monthlyFrom">
To: <input type="date" id="monthlyTo">
<button onclick="downloadMonthlyReportCSV()">Download Monthly Billing</button>

<h4>Item Sales Report</h4>
From: <input type="date" id="salesFrom">
To: <input type="date" id="salesTo">
<button onclick="downloadItemSalesReportCSV()">Download Item Sales Report</button>
  <hr>
    <button onclick="viewTodayBills()">View Today's Bills</button>
    <input type="text" id="customerName" placeholder="Customer Name" />
    <input type="text" id="customerMobile" placeholder="Mobile Number" />
    <input type="number" id="tax" placeholder="Tax % (optional)" />
    <input class="search-box" type="text" id="searchInput" oninput="filterMenu()" placeholder="Search menu...">
    <select id="menuSelect"></select>
    <input type="number" id="menuQty" placeholder="Qty" min="1" value="1" />
    <button onclick="addItem()">Add</button>
    <br>
    <input type="text" id="specialName" placeholder="Special Item" />
    <input type="number" id="specialRate" placeholder="Rate" />
    <input type="number" id="specialQty" placeholder="Qty" value="1" min="1" />
    <button onclick="addSpecialItem()">Add Special</button>
    <br>
    <button onclick="generateBill()">Generate Bill</button>
    <button onclick="window.print()">Print Bill</button>
  </div>

  <script>
const firebaseConfig = {
  apiKey: "AIza...",
  authDomain: "yourproject.firebaseapp.com",
  databaseURL: "https://yourproject-default-rtdb.firebaseio.com",
  projectId: "yourproject",
  storageBucket: "yourproject.appspot.com",
  messagingSenderId: "123...",
  appId: "1:123:web:abc..."
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
    const menu = {
      "Shahi Paneer": 120,
      "Matar Paneer": 100,
      "Aloo Posto": 70,
      "Kasha Aloo Dum": 50,
      "Moong Dal": 60,
      "Paneer Butter Masala": 140,
      "Paneer Bhurjee": 120,
      "Fish Finger (Bhetki) - 5pcs": 160,
      "Fish Fry (Bhetki)": 180,
      "Dry Chilli Chicken - 8pcs": 150,
      "Chicken Finger - 6pcs": 120,
      "Chicken Pakora - 6pcs": 100,
      "Paneer Pakora - 6pcs": 120,
      "Egg Chicken Fried Rice": 140,
      "Veg Fried Rice": 80,
      "Egg Fried Rice": 100,
      "Chicken Fried Rice": 120,
      "Basanti Polao": 80,
      "Steamed Rice - Basmati": 70,
      "Steamed Rice - Plain": 50,
      "Roti per pc": 6,
      "Tawa Paratha per pc": 12,
      "Green Salad": 50,
      "Onion Salad": 30,
      "Chicken Thali": 120,
      "Fish Thali (Rohu)": 100,
      "Fish Thali (Katla)": 100,
      "Egg Thali": 80,
      "Veg Thali": 60,
      "Mutton Thali": 220,
      "Chilli Chicken - 4pc": 80,
      "Chilli Chicken - 8pc": 150,
      "Schezwan Chicken - 4pc": 80,
      "Schezwan Chicken - 8pc": 150,
      "Hot Garlic Chicken - 4pc": 80,
      "Hot Garlic Chicken - 8pc": 150,
      "Chicken Kasha - 2pc": 70,
      "Chicken Kasha - 4pc": 130,
      "Shahi Chicken - 2pc": 90,
      "Shahi Chicken - 4pc": 160,
      "Egg Kasha - 1pc": 30,
      "Egg Kasha - 2pc": 50,
      "Rohu Fish Curry - 1pc": 60,
      "Rohu Fish Curry - 2pc": 100,
      "Katla Fish Curry - 1pc": 90,
      "Katla Fish Curry - 2pc": 170,
      "Mutton Kasha - 2pc": 160,
      "Mutton Kasha - 4pc": 300,
      "4pcs Roti+4pcs Chicken Kasha+Salad": 130,
      "4pcs Roti+2pcs Chicken Kasha+Salad": 90,
      "4pcs Roti+4pcs Chilli Chicken": 120,
      "4pcs Roti+2pcs Chilli Chicken": 90,
      "4pcs Roti+Paneer": 120,
      "3pcs Tawa Paratha+Paneer": 120,
      "3pcs Tawa Paratha+4pcs Chicken Kasha+Salad": 150,
      "3pcs Tawa Paratha+2pcs Chicken Kasha+Salad": 120,
      "3pcs Tawa Paratha+4pcs Chilli Chicken": 120,
      "3pcs Tawa Paratha+2pcs Chilli Chicken": 90,
      "Basanti Polao+4pcs Chicken Kasha": 150,
      "Basanti Polao+2pcs Chicken Kasha": 100,
      "Basanti Polao+2pcs Egg Kasha": 100,
      "Basanti Polao+Paneer": 120,
      "Basanti Polao+4pcs Mutton Kasha": 320,
      "Basanti Polao+2pcs Mutton Kasha": 220,
      "Veg Fried Rice+4pcs Chicken Kasha": 150,
      "Veg Fried Rice+2pcs Chicken Kasha": 100,
      "Veg Fried Rice+4pcs Chilli Chicken": 140,
      "Veg Fried Rice+2pcs Chilli Chicken": 100,
      "Veg Fried Rice+Paneer": 120,
      "Egg Fried Rice+4pcs Chicken Kasha": 160,
      "Egg Fried Rice+2pcs Chicken Kasha": 120,
      "Egg Fried Rice+4pcs Chilli Chicken": 150,
      "Egg Fried Rice+2pcs Chilli Chicken": 120,
      "Egg Chicken Fried Rice+4pcs Chicken Kasha": 180,
      "Egg Chicken Fried Rice+2pcs Chicken Kasha": 150,
      "Egg Chicken Fried Rice+4pcs Chilli Chicken": 180,
      "Egg Chicken Fried Rice+2pcs Chilli Chicken": 150
    };

    const billItems = [];
    const menuSelect = document.getElementById("menuSelect");
    const searchInput = document.getElementById("searchInput");

    function populateMenu(filter = "") {
      menuSelect.innerHTML = "";
      for (let key in menu) {
        if (key.toLowerCase().includes(filter.toLowerCase())) {
          const option = document.createElement("option");
          option.value = key;
          option.textContent = `${key} - ₹${menu[key]}`;
          menuSelect.appendChild(option);
        }
      }
    }

    function filterMenu() {
      populateMenu(searchInput.value);
    }

    function addItem() {
      const item = menuSelect.value;
      const qty = parseInt(document.getElementById("menuQty").value);
      const rate = menu[item];
      if (item && qty > 0) billItems.push({ name: item, qty, rate });
      renderBill();
    }

    function addSpecialItem() {
      const name = document.getElementById("specialName").value;
      const rate = parseFloat(document.getElementById("specialRate").value);
      const qty = parseInt(document.getElementById("specialQty").value);
      if (name && rate && qty) billItems.push({ name, rate, qty });
      renderBill();
      document.getElementById("specialName").value = "";
      document.getElementById("specialRate").value = "";
      document.getElementById("specialQty").value = 1;
    }

    function renderBill() {
      const tbody = document.querySelector("#billTable tbody");
      tbody.innerHTML = "";
      let subtotal = 0;
      billItems.forEach(item => {
        const total = item.qty * item.rate;
        subtotal += total;
        tbody.innerHTML += `<tr><td>${item.name}</td><td>${item.qty}</td><td>${item.rate}</td><td>${total}</td></tr>`;
      });
      const taxRate = parseFloat(document.getElementById("tax").value) || 0;
      const taxAmount = subtotal * (taxRate / 100);
      const grandTotal = subtotal + taxAmount;
      document.getElementById("totalDisplay").innerText = `Sub Total: ₹${subtotal.toFixed(2)}\nTotal: ₹${grandTotal.toFixed(2)}`;
    }

    function generateBill() {
db.ref("bills").push({
  billNo,
  date: new Date().toISOString(),
  name,
  mobile,
  items,
  subtotal,
  tax,
  total
});
      const name = document.getElementById("customerName").value;
      const mobile = document.getElementById("customerMobile").value;
      if (!name || !mobile) return alert("Customer name & mobile required");
      document.getElementById("customerDisplay").innerText = `${name} | ${mobile}`;
      saveLastBillNumber();
      renderBill();
      saveBillToHistory();
    }

    function loadLastBillNumber() {
      const last = parseInt(localStorage.getItem("lastBillNumber")) || 1000;
      document.getElementById("billNumber").innerText = last + 1;
    }

    function saveLastBillNumber() {
      const last = parseInt(localStorage.getItem("lastBillNumber")) || 1000;
      localStorage.setItem("lastBillNumber", last + 1);
      document.getElementById("billNumber").innerText = last + 1;
    }

    function saveBillToHistory() {
      const name = document.getElementById("customerName").value;
      const mobile = document.getElementById("customerMobile").value;
      const date = new Date().toISOString();
      const tax = parseFloat(document.getElementById("tax").value) || 0;
      let subtotal = 0;
      const items = billItems.map(item => {
        const total = item.qty * item.rate;
        subtotal += total;
        return `${item.name} (x${item.qty}) = ₹${total}`;
      });
      const taxAmount = subtotal * (tax / 100);
      const grandTotal = subtotal + taxAmount;
      const bill = {
        billNo: document.getElementById("billNumber").innerText,
        date,
        name,
        mobile,
        items,
        subtotal,
        tax: taxAmount,
        total: grandTotal
      };
      const history = JSON.parse(localStorage.getItem("billHistory") || "[]");
      history.push(bill);
      localStorage.setItem("billHistory", JSON.stringify(history));
    }

    function downloadHistoryCSV() {
      const history = JSON.parse(localStorage.getItem("billHistory") || "[]");
      if (history.length === 0) return alert("No history found");
      const rows = [["Bill No", "Date", "Customer Name", "Mobile", "Items", "Subtotal", "Tax", "Total"]];
      history.forEach(bill => {
        rows.push([
          bill.billNo,
          bill.date,
          bill.name,
          bill.mobile,
          bill.items.join(" | "),
          bill.subtotal,
          bill.tax,
          bill.total
        ]);
      });
      const csv = rows.map(r => r.join(",")).join("\n");
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'bill_history.csv';
      a.click();
      URL.revokeObjectURL(url);
    }

    function viewTodayBills() {
      const history = JSON.parse(localStorage.getItem("billHistory") || "[]");
      const today = new Date().toISOString().split('T')[0];
      const billsToday = history.filter(bill => bill.date.includes(today));
      if (billsToday.length === 0) return alert("No bills found for today");
      let output = billsToday.map(bill => `Bill#${bill.billNo} | ${bill.name} | ₹${bill.total}`).join("\n");
      alert(output);
    }

    window.onload = () => {
      populateMenu();
      loadLastBillNumber();
    };
function downloadMonthlyReportCSV() {
  const from = document.getElementById("monthlyFrom").value;
  const to = document.getElementById("monthlyTo").value;
  const history = JSON.parse(localStorage.getItem("billHistory") || "[]");
  const filtered = history.filter(b => b.date.split("T")[0] >= from && b.date.split("T")[0] <= to);
  if (filtered.length === 0) return alert("No bills found in this date range");

  const rows = [["Bill No", "Date", "Customer Name", "Mobile", "Items", "Subtotal", "Tax", "Total"]];
  filtered.forEach(bill => {
    rows.push([bill.billNo, bill.date, bill.name, bill.mobile, bill.items.join(" | "), bill.subtotal, bill.tax, bill.total]);
  });

  const csv = rows.map(r => r.join(",")).join("\\n").replace(/\\n/g, "\n");
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'monthly_billing_history.csv';
  a.click();
  URL.revokeObjectURL(url);
}

function downloadItemSalesReportCSV() {
  const from = document.getElementById("salesFrom").value;
  const to = document.getElementById("salesTo").value;
  const history = JSON.parse(localStorage.getItem("billHistory") || "[]");
  const filtered = history.filter(b => b.date.split("T")[0] >= from && b.date.split("T")[0] <= to);
  const items = {};

  filtered.forEach(bill => {
    (bill.items || []).forEach(str => {
      const match = str.match(/^(.*?)\s*\(x(\d+)\).*₹(\d+)/);
      if (match) {
        const name = match[1].trim();
        const qty = parseInt(match[2]);
        const amt = parseFloat(match[3]);
        if (!items[name]) items[name] = { qty: 0, total: 0 };
        items[name].qty += qty;
        items[name].total += amt;
      }
    });
  });

  if (Object.keys(items).length === 0) return alert("No sales found in this date range");

  const rows = [["Item", "Quantity Sold", "Total Sales (₹)"]];
  for (let item in items) {
    rows.push([item, items[item].qty, items[item].total.toFixed(2)]);
  }

  const csv = rows.map(r => r.join(",")).join("\n");
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'item_sales_report.csv';
  a.click();
  URL.revokeObjectURL(url);
}
  </script>
</body>
</html>
